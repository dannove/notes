"__kernel void buildWarpSphericalMaps(__global uchar * xmapptr, int xmap_step, int xmap_offset,\r\n"
"__global uchar * ymapptr, int ymap_step, int ymap_offset, int rows, int cols,\r\n"
"__constant float * ck_rinv, int tl_u, int tl_v, float scale, int rowsPerWI)\r\n"
"{\r\n"
"int du = get_global_id(0);\r\n"
"int dv0 = get_global_id(1) * rowsPerWI;\r\n"
"if (du < cols)\r\n"
"{\r\n"
"int xmap_index = mad24(dv0, xmap_step, mad24(du, (int)sizeof(float), xmap_offset));\r\n"
"int ymap_index = mad24(dv0, ymap_step, mad24(du, (int)sizeof(float), ymap_offset));\r\n"
"float u = (tl_u + du) * scale;\r\n"
"float cosu, sinu = sincos(u, &cosu);\r\n"
"for (int dv = dv0, dv1 = min(rows, dv0 + rowsPerWI); dv < dv1; ++dv, xmap_index += xmap_step,\r\n"
"ymap_index += ymap_step)\r\n"
"{\r\n"
"__global float * xmap = (__global float *)(xmapptr + xmap_index);\r\n"
"__global float * ymap = (__global float *)(ymapptr + ymap_index);\r\n"
"float v = (tl_v + dv) * scale;\r\n"
"float cosv, sinv = sincos(v, &cosv);\r\n"
"float x_ = sinv * sinu;\r\n"
"float y_ = -cosv;\r\n"
"float z_ = sinv * cosu;\r\n"
"float x, y, z;\r\n"
"x = fma(ck_rinv[0], x_, fma(ck_rinv[1], y_, ck_rinv[2] * z_));\r\n"
"y = fma(ck_rinv[3], x_, fma(ck_rinv[4], y_, ck_rinv[5] * z_));\r\n"
"z = fma(ck_rinv[6], x_, fma(ck_rinv[7], y_, ck_rinv[8] * z_));\r\n"
"if (z > 0)\r\n"
"x /= z, y /= z;\r\n"
"else\r\n"
"x = y = -1;\r\n"
"xmap[0] = x;\r\n"
"ymap[0] = y;\r\n"
"}\r\n"
"}\r\n"
"}\r\n"